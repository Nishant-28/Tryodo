-- This file contains instructions to fix the AuthContext.tsx profile creation issue

## QUICK FIX FOR AUTHENTICATION ISSUES

### Step 1: Run the RLS Policy Fix
First, run the `fix-profile-rls-policies.sql` script in your Supabase SQL Editor.

### Step 2: Alternative - Disable RLS Temporarily
If the issue persists, you can temporarily disable RLS for the profiles table to allow profile creation:

```sql
-- Temporarily disable RLS on profiles table
ALTER TABLE profiles DISABLE ROW LEVEL SECURITY;

-- Test login/signup, then re-enable with proper policies:
-- ALTER TABLE profiles ENABLE ROW LEVEL SECURITY;
```

### Step 3: Manual Profile Creation
If you need to manually create an admin profile for testing:

```sql
-- Find your user ID first
SELECT id, email FROM auth.users WHERE email = 'your-email@example.com';

-- Insert profile manually (replace 'your-user-id' with the actual UUID)
INSERT INTO profiles (user_id, email, role, full_name, is_active) 
VALUES ('your-user-id', 'your-email@example.com', 'admin', 'Your Name', true)
ON CONFLICT (user_id) DO UPDATE SET 
    role = 'admin',
    is_active = true;
```

### Step 4: Create Test Admin Account
Use the function from the RLS fix script:

```sql
SELECT create_test_admin('admin@test.com', 'password123', 'Test Admin');
```

### Step 5: Clear Browser Storage
After running the database fixes:
1. Open browser DevTools (F12)
2. Go to Application/Storage tab
3. Clear all Local Storage and Session Storage
4. Refresh the page and try logging in again

### Alternative Quick Fix - Update Environment
Make sure your Supabase environment variables are correct:
- VITE_SUPABASE_URL should be your project URL
- VITE_SUPABASE_ANON_KEY should be your anon/public key

### Test the Fix
1. After running the RLS script, try signing up with a new account
2. Try logging in with existing account
3. Check browser console for any remaining errors

The main issue is that the RLS policies were preventing users from creating their own profiles. The fix script creates proper policies that allow users to create and manage their own profiles while giving admins full access to all profiles. 